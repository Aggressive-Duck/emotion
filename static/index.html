<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decode Emotion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@500;700&display=swap" rel="stylesheet">

    <script>
        // 初始化主題
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark')
        } else {
            document.documentElement.classList.remove('dark')
        }

        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['"Inter"', '-apple-system', 'BlinkMacSystemFont', 'sans-serif'],
                        'mono': ['"JetBrains Mono"', 'ui-monospace', 'SFMono-Regular', 'monospace'],
                        'cute': ['"M PLUS Rounded 1c"', 'sans-serif'],
                    },
                    colors: {
                        apple: {
                            bg: 'var(--bg-color)',
                            text: 'var(--text-color)',
                        }
                    },
                    animation: {
                        'float-slow': 'float 8s ease-in-out infinite',
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-6px)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        :root {
            --bg-color: #F5F5F7;
            --text-color: #1D1D1F;
        }

        .dark {
            --bg-color: #000000;
            --text-color: #F5F5F7;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            position: relative;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* === 背景文字層 === */
        body::before {
            content: "";
            position: fixed;
            top: 50%;
            left: 0;
            width: 100%;
            height: 300px;
            transform: translateY(-50%);
            z-index: -1;
            pointer-events: none;
            background-repeat: repeat-x;
            background-position: center center;
            background-size: auto 100%;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='300' viewBox='0 0 1200 300'%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Inter, -apple-system, BlinkMacSystemFont, sans-serif' font-weight='900' font-size='160' fill='%23EAEAEA' letter-spacing='-4'%3EDECODE EMOTION %3C/text%3E%3C/svg%3E");
            transition: background-image 0.3s ease;
        }

        .dark body::before {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='1200' height='300' viewBox='0 0 1200 300'%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='Inter, -apple-system, BlinkMacSystemFont, sans-serif' font-weight='900' font-size='160' fill='%231A1A1A' letter-spacing='-4'%3EDECODE EMOTION %3C/text%3E%3C/svg%3E");
        }

        /* 滾動條樣式優化 */
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(0, 0, 0, 0.15); border-radius: 10px; }
        .dark .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(255, 255, 255, 0.25); }
        .custom-scrollbar:hover::-webkit-scrollbar-thumb { background-color: rgba(0, 0, 0, 0.3); }

        .spring-transition {
            transition-property: width, height, transform, opacity, border-radius, background-color;
            transition-duration: 0.7s;
            transition-timing-function: cubic-bezier(0.19, 1, 0.22, 1);
        }

        .no-shadow { box-shadow: none !important; }

        .waveform-bar { animation: wave 1s ease-in-out infinite; }
        @keyframes wave {
            0%, 100% { height: 30%; opacity: 0.4; }
            50% { height: 100%; opacity: 1; }
        }

        .kaomoji-anim {
            transition: transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease, filter 0.3s ease;
            transform-origin: center center;
            display: inline-block;
        }
        .kaomoji-hidden { opacity: 0; transform: scale(0.4); filter: blur(4px); }
        .kaomoji-visible { opacity: 0.95; transform: scale(1); filter: blur(0); }

        @keyframes uniform-ripple {
            0% { width: 128px; height: 40px; opacity: 0; border-color: rgba(100, 100, 100, 0.2); }
            20% { opacity: 1; }
            100% { width: 188px; height: 100px; opacity: 0; border-color: rgba(100, 100, 100, 0); }
        }
        
        .signal-ring {
            position: absolute; top: 20px; left: 50%; transform: translate(-50%, -50%); 
            border-radius: 9999px; border: 1.5px solid;
            background: transparent; z-index: 0; pointer-events: none; box-sizing: border-box;
        }
        .signal-active { animation: uniform-ripple 3s cubic-bezier(0.25, 1, 0.5, 1) infinite; }
        .dark .signal-active { border-color: rgba(255, 255, 255, 0.15); }
    </style>
</head>
<body class="h-screen w-full font-sans flex flex-col">

    <button id="themeToggle" class="fixed top-6 right-6 z-50 w-9 h-9 bg-white dark:bg-neutral-800 rounded-full flex items-center justify-center transition-colors duration-300 hover:bg-neutral-100 dark:hover:bg-neutral-700" aria-label="Toggle Theme">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-neutral-200 hidden dark:block">
            <circle cx="12" cy="12" r="4"></circle>
            <path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path>
        </svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-5 h-5 text-neutral-700 block dark:hidden">
            <path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path>
        </svg>
    </button>

    <div class="w-full pt-14 pb-4 z-40 relative shrink-0">
        <div class="relative flex justify-center items-start w-full">
            <div id="idleSignal" class="signal-ring signal-active transition-colors duration-300"></div>

            <div id="dynamicIsland" 
                 class="bg-black dark:border dark:border-neutral-800 rounded-[40px] text-white overflow-hidden spring-transition relative flex flex-col items-center justify-start z-10 no-shadow origin-[center_top]"
                 style="width: 128px; height: 40px;">
                
                <div id="stateIdle" class="absolute inset-0 flex items-center justify-center w-full h-full transition-opacity duration-300 delay-100">
                     <span id="kaomojiContainer" class="font-cute text-[13px] tracking-widest text-white/90 kaomoji-anim kaomoji-visible whitespace-nowrap">
                        ( • ᴗ • )
                     </span>
                </div>

                <div id="stateProcessing" class="absolute inset-0 flex items-center justify-between px-8 opacity-0 transition-opacity duration-300 pointer-events-none">
                    <span class="text-[11px] font-medium tracking-wider text-neutral-300">Processing...</span>
                    <div class="flex items-center gap-[3px] h-4">
                        <div class="w-[3px] bg-white rounded-full waveform-bar" style="animation-delay: 0s"></div>
                        <div class="w-[3px] bg-white rounded-full waveform-bar" style="animation-delay: 0.1s"></div>
                        <div class="w-[3px] bg-white rounded-full waveform-bar" style="animation-delay: 0.2s"></div>
                        <div class="w-[3px] bg-white rounded-full waveform-bar" style="animation-delay: 0.3s"></div>
                        <div class="w-[3px] bg-white rounded-full waveform-bar" style="animation-delay: 0.4s"></div>
                    </div>
                </div>

                <div id="stateResult" class="w-full h-full opacity-0 transition-opacity duration-500 delay-75 flex flex-col p-8 pointer-events-none">
                    <div class="flex justify-between items-start mb-5">
                        <div class="flex flex-col gap-1">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-neutral-400">Classification Result</span>
                            <h2 id="resultTitle" class="text-3xl font-semibold tracking-tight text-white">Neutral</h2>
                        </div>
                        <div class="w-10 h-10 rounded-full flex items-center justify-center bg-white/10">
                            <svg id="resultIcon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-white"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>
                        </div>
                    </div>
                    <div class="flex gap-4 mb-6 w-full">
                        <div class="bg-neutral-900/60 flex-1 rounded-2xl p-4">
                            <span class="text-[9px] font-bold uppercase text-neutral-500 block mb-1">Confidence</span>
                            <div class="flex items-baseline gap-1">
                                <span id="confidenceVal" class="text-2xl font-mono font-medium tracking-tight">98.2</span>
                                <span class="text-[11px] text-neutral-400">%</span>
                            </div>
                        </div>
                        <div class="bg-neutral-900/60 flex-1 rounded-2xl p-4">
                            <span class="text-[9px] font-bold uppercase text-neutral-500 block mb-1">Latency</span>
                            <div class="flex items-baseline gap-1">
                                <span class="text-2xl font-mono font-medium tracking-tight">42</span>
                                <span class="text-[11px] text-neutral-400">ms</span>
                            </div>
                        </div>
                    </div>
                    <div class="mt-auto">
                         <p id="resultDesc" class="text-[13px] text-neutral-300 leading-normal font-normal">Analysis complete.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main id="historyContainer" class="flex-1 w-full max-w-3xl mx-auto overflow-y-auto custom-scrollbar px-6 space-y-4 pb-32 pt-2 scroll-smooth relative z-10">
        <div id="placeholder" class="text-center mt-12 opacity-30 transition-opacity duration-300">
            <svg class="w-10 h-10 mx-auto mb-4 text-neutral-400 dark:text-neutral-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <p class="text-xs font-medium text-neutral-500 dark:text-neutral-500 uppercase tracking-widest">History Log Empty</p>
        </div>
    </main>

    <div class="fixed bottom-0 left-0 w-full z-50 px-6 pb-8 pointer-events-none">
        <div class="max-w-xl mx-auto relative group animate-float-slow pointer-events-auto">
            <textarea 
                   id="userInput"
                   rows="1"
                   placeholder="Type something to analyze..." 
                   class="w-full bg-white dark:bg-neutral-900 text-apple-text text-[15px] font-medium rounded-[24px] pl-6 pr-14 py-4 focus:outline-none focus:ring-4 focus:ring-neutral-200/50 dark:focus:ring-neutral-800/50 placeholder-neutral-400 dark:placeholder-neutral-600 transition-all no-shadow duration-300 resize-none overflow-y-auto custom-scrollbar block"
                   style="min-height: 56px; max-height: 180px;"
            ></textarea>
            
            <button id="sendBtn" class="absolute right-3 bottom-3 h-10 w-10 bg-black dark:bg-white text-white dark:text-black rounded-full flex items-center justify-center hover:scale-105 active:scale-95 transition-all disabled:opacity-50 disabled:scale-100 disabled:cursor-not-allowed duration-300">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="19" x2="12" y2="5"></line><polyline points="5 12 12 5 19 12"></polyline></svg>
            </button>
        </div>
    </div>

    <script>
        // THEME TOGGLE
        const themeToggleBtn = document.getElementById('themeToggle');
        const htmlElement = document.documentElement;

        themeToggleBtn.addEventListener('click', () => {
            htmlElement.classList.toggle('dark');
            localStorage.theme = htmlElement.classList.contains('dark') ? 'dark' : 'light';
        });

        // DOM Elements
        const island = document.getElementById('dynamicIsland');
        const idleSignal = document.getElementById('idleSignal');
        const stateIdle = document.getElementById('stateIdle');
        const kaomojiContainer = document.getElementById('kaomojiContainer');
        const stateProcessing = document.getElementById('stateProcessing');
        const stateResult = document.getElementById('stateResult');
        const userInput = document.getElementById('userInput');
        const sendBtn = document.getElementById('sendBtn');
        const historyContainer = document.getElementById('historyContainer');
        const placeholder = document.getElementById('placeholder');
        const resultTitle = document.getElementById('resultTitle');
        const resultDesc = document.getElementById('resultDesc');
        const confidenceVal = document.getElementById('confidenceVal');

        // KAOMOJI
        const kaomojis = [
            "( • ᴗ • )", "( ｡ • ̀ ᴗ - )", "( › ᴗ ‹ )", "( z z Z )", 
            "( O . O )", "( ˘ ▽ ˘ )", "( ¬ ‿ ¬ )", "( ◕ ‿ ◕ )"
        ];
        let kaomojiInterval;

        function startKaomojiRotation() {
            if (kaomojiInterval) clearInterval(kaomojiInterval);
            kaomojiInterval = setInterval(() => {
                kaomojiContainer.classList.remove('kaomoji-visible');
                kaomojiContainer.classList.add('kaomoji-hidden');
                setTimeout(() => {
                    const randomKaomoji = kaomojis[Math.floor(Math.random() * kaomojis.length)];
                    kaomojiContainer.innerText = randomKaomoji;
                    kaomojiContainer.classList.remove('kaomoji-hidden');
                    kaomojiContainer.classList.add('kaomoji-visible');
                }, 500);
            }, 4000);
        }
        startKaomojiRotation();

        // ANALYSIS LOGIC
        const sentiments = {
            'Positive': { desc: "Strong indications of satisfaction, joy, or agreement detected.", icon: '<path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>' },
            'Negative': { desc: "Negative polarity identified with markers of frustration.", icon: '<path d="M10 15v4a3 3 0 0 0 3 3l4-9V2H5.72a2 2 0 0 0-2 1.7l-1.38 9a2 2 0 0 0 2 2.3zm7-13h2.67A2.31 2.31 0 0 1 22 4v7a2.31 2.31 0 0 1-2.33 2H17"></path>' },
            'Neutral': { desc: "Content appears objective and balanced.", icon: '<circle cx="12" cy="12" r="10"></circle><line x1="8" y1="12" x2="16" y2="12"></line>' },
            'Urgent': { desc: "High arousal negative sentiment detected. Attention recommended.", icon: '<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line>' }
        };

        let isAnalyzing = false;

        function resizeIsland(width, height, borderRadius = '42px') {
            island.style.width = width;
            island.style.height = height;
            island.style.borderRadius = borderRadius;
        }

        function setOpacity(el, val) {
            el.style.opacity = val;
            el.style.pointerEvents = val === 0 ? 'none' : 'auto';
        }

        function scrollToBottom() {
            historyContainer.scrollTo({ top: historyContainer.scrollHeight, behavior: 'smooth' });
        }

        function createHistoryItem(text, sentiment, score) {
            const div = document.createElement('div');
            div.className = "bg-white dark:bg-neutral-900 rounded-2xl p-5 animate-[fadeInUp_0.4s_ease-out_forwards] transition-colors duration-300";
            
            let tagColor = "bg-neutral-500 text-white";
            if(sentiment === 'Positive') tagColor = "bg-emerald-500 text-white";
            if(sentiment === 'Negative') tagColor = "bg-rose-500 text-white";
            if(sentiment === 'Urgent') tagColor = "bg-orange-500 text-white";

            div.innerHTML = `
                <div class="flex justify-between items-center mb-3">
                    <span class="text-[11px] font-bold px-3 py-1 rounded-full ${tagColor} uppercase tracking-wider leading-none">${sentiment}</span>
                    <span class="text-[10px] font-medium text-neutral-400 dark:text-neutral-500">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                </div>
                <p class="text-[14px] text-neutral-800 dark:text-neutral-200 font-medium leading-relaxed whitespace-pre-wrap">${text}</p>
                <div class="flex gap-3 mt-3 pt-3 border-t border-neutral-100/50 dark:border-neutral-800/50">
                    <div class="flex items-center gap-1">
                        <svg class="w-3 h-3 text-neutral-400 dark:text-neutral-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
                        <span class="text-[10px] font-bold text-neutral-500 dark:text-neutral-400">${score}% Score</span>
                    </div>
                </div>
            `;
            return div;
        }

        async function analyze() {
            const text = userInput.value.trim();
            if (!text || isAnalyzing) return;
            isAnalyzing = true;
            sendBtn.disabled = true;
            userInput.disabled = true;
            if (placeholder) placeholder.style.display = 'none';

            idleSignal.style.display = 'none'; 
            clearInterval(kaomojiInterval);

            setOpacity(stateIdle, 0);
            setOpacity(stateResult, 0);
            resizeIsland('220px', '50px');
            setTimeout(() => setOpacity(stateProcessing, 1), 250);

            await new Promise(r => setTimeout(r, 1500));

            const keys = Object.keys(sentiments);
            const resultKey = keys[Math.floor(Math.random() * keys.length)];
            const data = sentiments[resultKey];
            const score = (85 + Math.random() * 14).toFixed(1);

            resultTitle.innerText = resultKey;
            resultDesc.innerText = data.desc;
            confidenceVal.innerText = score;
            document.getElementById('resultIcon').innerHTML = data.icon;

            setOpacity(stateProcessing, 0);
            resizeIsland('380px', '300px', '45px');
            setTimeout(() => setOpacity(stateResult, 1), 350);

            setTimeout(() => {
                setOpacity(stateResult, 0);
                resizeIsland('128px', '40px');
                setTimeout(() => {
                    setOpacity(stateIdle, 1);
                    idleSignal.style.display = 'block';
                    startKaomojiRotation();

                    const historyItem = createHistoryItem(text, resultKey, score);
                    historyContainer.appendChild(historyItem);
                    scrollToBottom();
                    
                    // 重置輸入框
                    userInput.value = '';
                    userInput.style.height = '56px'; // Reset
                    userInput.disabled = false;
                    userInput.focus();
                    sendBtn.disabled = false;
                    isAnalyzing = false;
                }, 500);
            }, 4000);
        }

        sendBtn.addEventListener('click', analyze);
        
        // AUTO-RESIZE LOGIC (Fix: Reset to 'auto' to allow shrinking)
        userInput.addEventListener('input', function() {
            // 先將高度重置為 auto，這樣如果文字減少，scrollHeight 會變小
            this.style.height = 'auto'; 
            // 重新設定高度，這時候會被 max-height 限制住
            this.style.height = (this.scrollHeight) + 'px';
        });

        userInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                analyze();
            }
        });
        
        userInput.focus();

        const styleSheet = document.createElement("style");
        styleSheet.innerText = `
            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(20px) scale(0.98); }
                to { opacity: 1; transform: translateY(0) scale(1); }
            }
        `;
        document.head.appendChild(styleSheet);
    </script>
</body>
</html>